      TI301 â€“ Algorithmique et Structures de donnÃ©es 2

                Projet Informatique et MathÃ©matiques
          Ce projet est rÃ©digÃ© en commun avec le dÃ©partement de
                               mathÃ©matiques

              Etude de Graphes de Markov â€“ PARTIE 3

Il est maintenant temps de nous intÃ©resser aux propriÃ©tÃ©s de ces graphes pour les probabilitÃ©s.

Notion de distribution
Pour le moment, nous avons associÃ© des probabilitÃ©s aux arÃªtes, indiquant quelle est la
probabilitÃ© de passer dâ€™un Ã©tat Ã  un autre.

Un systÃ¨me, Ã  un instant donnÃ©, devrait se trouver dans un Ã©tat dÃ©ï¬ni en fonction dâ€™un Ã©tat de
â€˜dÃ©partâ€™. Cependant, comme les transitions sont probabilistes, il nâ€™est pas possible dâ€™a irmer
que le systÃ¨me se trouvera dans â€˜tel Ã©tatâ€™ aprÃ¨s â€˜un certain nombreâ€™ de transitions.

En revanche, on peut indiquer, pour le systÃ¨me, quelles sont les probabilitÃ©s quâ€™il se trouve dans
un Ã©tat donnÃ© Ã  un instant ğ‘¡, en fonction dâ€™un â€˜Ã©tatâ€™ de dÃ©part.

Illustrations et exemples avec une graphe de Markov pour la mÃ©tÃ©o
Soit le graphe de Markov suivant, illustrant (de maniÃ¨re totalement arbitraire), les Ã©volutions de
la mÃ©tÃ©o jour aprÃ¨s jour : chaque Ã©tat reprÃ©sente la mÃ©tÃ©o dâ€™une journÃ©e, chaque transition
indique la probabilitÃ© de passer dâ€™un Ã©tat Ã  lâ€™autre. Le â€˜temps discretâ€™ utilisÃ© est une journÃ©e : on
â€˜calculeâ€™ les Ã©volutions dâ€™un jour ğ½ Ã  un jour ğ½ + 1, puis de ğ½ + 1 Ã  ğ½ + 2, et ainsi de suite.
Une distribution reprÃ©sente, sur ce graphe, les probabilitÃ©s dâ€™Ãªtre dans un Ã©tat donnÃ© Ã  un instant
donnÃ©. Une distribution est la rÃ©partition de probabilitÃ©s sur tous les Ã©tats : sa somme doit Ãªtre
Ã©gale Ã  1. Il sâ€™agit dâ€™un vecteur ligne, oÃ¹ chaque coordonnÃ©e indique la probabilitÃ© de chaque Ã©tat
du graphe.

La notation consacrÃ©e pour une distribution est : Î 

Exemple
Aujourdâ€™hui il faut beau (Â« Sunny Â») : indique que la probabilitÃ© de se trouver dans lâ€™Ã©tat 1 est Ã©gale
Ã  1, toutes les autres valant 0.

La distribution associÃ©e est alors Î  = (1 0      0 0     0)
Voici un petit tableau pour vous aider Ã  interprÃ©ter cette distribution

  NumÃ©ro de
                         1                2                3                4                5
     lâ€™Ã©tat
    MÃ©tÃ©o
                      Sunny            Cloudy            Rain             Storm        Sunny spells
   associÃ©e
  ProbabilitÃ©            1                0                0                0                0


Calcul de lâ€™Ã©volution en temps discret dâ€™une distribution
En Ã©tudiant les distributions, les graphes de Markov nous permettent de rÃ©pondre aux questions
du type :

    1. Â« Quelle est la probabilitÃ© que le temps soit nuageux (Cloudy) dans 3 jours sâ€™il fait beau
       (Sunny) aujourdâ€™hui Â» ?
    2. Â« Quelles sont les probabilitÃ©s que la mÃ©tÃ©o soit dans tel Ã©tat dans une semaine (7 jours)
       sachant quâ€™il pleut (Rain) aujourdâ€™hui ? Â»
    3. Â« Atteint-on des probabilitÃ©s indÃ©pendantes de la distribution de dÃ©part au bout dâ€™un
       certain temps ? Â» (en termes mathÃ©matiques, existe-t-il une distribution stationnaire ?)

Principes de calcul
Le graphe de Markov Ã©tant reprÃ©sentÃ© par une matrice ğ‘€ , et connaissant une distribution initiale
Î  , on calcule lâ€™Ã©volution de la distribution Î  = Î  . ğ‘€
On peut ensuite recommencer, et calculer : Î  = Î  . ğ‘€ = (Î  . ğ‘€). ğ‘€ = Î  . ğ‘€

De proche en proche, on peut donc calculer lâ€™Ã©volution de la distribution initiale Î  aprÃ¨s n
Ã©tapes : Î  = Î  . ğ‘€
Illustration avec le graphe â€˜MÃ©tÃ©oâ€™
La matrice ğ‘€ indique les probabilitÃ©s de passage dâ€™un Ã©tat Ã  un autre â€“ voici la reprÃ©sentation
matricielle du graphe pris en exemple.




                                    0.34          0.27  0   0.18 0.21
                                   â›0.20          0.40 0.20  0   0.20â
                                 ğ‘€=âœ 0            0.41 0.37 0.09 0.13âŸ
                                     0            0.68 0.20 0.12  0
                                   â0.12          0.30  0    0   0.58â 


Quels calculs devons-nous e ectuer pour rÃ©pondre aux questions posÃ©es ?
   1.   Â« Quelle est la probabilitÃ© que le temps soit nuageux (Cloudy) dans 3 jours sâ€™il fait beau (Sunny)
        aujourdâ€™hui Â» ?
   2.   Â« Quelles sont les probabilitÃ©s que la mÃ©tÃ©o soit dans tel Ã©tat dans une semaine (7 jours) sachant quâ€™il pleut
        (Rain) aujourdâ€™hui ? Â»
   3.   Â« Atteint-on des probabilitÃ©s indÃ©pendantes de la distribution de dÃ©part au bout dâ€™un certain temps ? Â» (en
        termes mathÃ©matiques, existe-t-il une distribution stationnaire ?)



Pour la question 1 : la distribution initiale est Î  = (1 0 0 0 0), on cherche Ã  calculer :

Î  = Î  . ğ‘€ , (3 pour â€˜dans 3 joursâ€™) et on obtient :

                                          0.17         0.37     0.13    0.05    0.27
                                         â›0.16         0.37     0.14    0.05    0.28â
                                     ğ‘€ = âœ0.14         0.38     0.18    0.04    0.25âŸ
                                          0.15         0.38     0.18    0.05    0.24
                                         â0.17         0.34     0.09    0.04    0.35â 
Puisque Î  = (1 0          0 0 0) , Î  = (0.17 0.37 0.13 0.05 0.27)
 NumÃ©ro de
                        1                2                3                4                5
     lâ€™Ã©tat
    MÃ©tÃ©o
                      Sunny           Cloudy             Rain            Storm        Sunny spells
   associÃ©e
  ProbabilitÃ©
 au bout de 3          0.17             0.37             0.13             0.05             0.27
     jours


Ainsi, sâ€™il fait beau (Sunny) aujourdâ€™hui, la probabilitÃ© que le temps soit nuageux (Cloudy) dans 3
jours est 0.37 = 37 %.

Pour la question 2 : la distribution initiale est Î  = (0 0 1 0 0), (il pleut, lâ€™Ã©tat est â€˜Rainâ€™) on
cherche Ã  calculer : Î  = Î  . ğ‘€ , (7 pour calculer â€˜dans 7 joursâ€™) et on obtient :



                                      0.16      0.36   0.13     0.05   0.29
                                     â›0.16      0.36   0.13     0.05   0.29â
                                 ğ‘€ = âœ0.16      0.36   0.13     0.05   0.29âŸ
                                      0.16      0.36   0.13     0.05   0.29
                                     â0.16      0.36   0.13     0.05   0.30â 
Puisque Î  = (0 0       1 0 0) , Î  = (0.16 0.36 0.13 0.05 0.29)
Ainsi, sâ€™il pleut aujourdâ€™hui : dans une semaine, il y 16% de chances quâ€™il fasse beau, 36% de
chances que le temps soit nuageux, 13% de chances quâ€™il pleuve, 5% de chances que le temps
soit orageux, et 29% de chances quâ€™il y ait des Ã©claircies.

Pour la question 3 : on constate dÃ©jÃ  que, dans la matrice ğ‘€ , toutes les lignes sont Ã©gales
(modulo les arrondis), et ainsi, quel que soit lâ€™Ã©tat de dÃ©part (=le temps quâ€™il fait aujourdâ€™hui), on
arrive au mÃªme rÃ©sultat :

Quelle que soit la mÃ©tÃ©o aujourdâ€™hui, dans une semaine : il y 16% de chances quâ€™il fasse beau,
36% de chances que le temps soit nuageux, 13% de chances quâ€™il pleuve, 5% de chances que le
temps soit orageux, et 29% de chances quâ€™il y ait des Ã©claircies. Cela est aussi dÃ» au fait que câ€™est
une reprÃ©sentation trÃ¨s simpliï¬Ã©e de lâ€™Ã©volution de la mÃ©tÃ©o.

La distribution, nommÃ©e Î âˆ— = (0.16 0.36 0.13 0.05 0.29) est dite stationnaire. Il nâ€™y aura
plus dâ€™Ã©volution des probabilitÃ©s, et on a donc : Î  âˆ— . ğ‘€ = Î  âˆ—
A vous de jouer
       Vous pouvez utiliser des outils dâ€™IA pour cette partie, mais devrez expliquer :

   ïƒ¼ Si vous utilisÃ© de tels outils ;
   ïƒ¼ Le prompt que vous avez utilisÃ© ;
   ïƒ¼ Le code obtenu.

                 Ces questions vous seront posÃ©es lors de la soutenance

Ã‰tape 1 : calculs matriciels
En utilisant des ï¬chiers matrix.c / matrix.h , dÃ©ï¬nissez les fonctions suivantes :

   ïƒ¼ Une fonction qui, Ã  partir dâ€™une liste dâ€™adjacence pour un graphe Ã  ğ‘› Ã©tats, crÃ©e une
     matrice ğ‘› ğ‘¥ ğ‘› remplie avec les probabilitÃ©s de passage entre Ã©tats ;
   ïƒ¼ Une fonction qui crÃ©e une matrice ğ‘› ğ‘¥ ğ‘› remplie avec la valeur 0 ;
   ïƒ¼ Une fonction qui recopie les valeurs dâ€™une matrice dans une autre de mÃªme taille ;
   ïƒ¼ Une fonction de multiplication de deux matrices ğ‘› ğ‘¥ ğ‘› ;
   ïƒ¼ Une fonction qui calcule â€˜la di Ã©renceâ€™ entre deux matrices ğ‘€ et ğ‘ : ğ‘‘ğ‘–ğ‘“ğ‘“(ğ‘€, ğ‘) =
     âˆ‘ âˆ‘ ğ‘š âˆ’ ğ‘› â€“ somme des valeurs absolues des di Ã©rences entre les coe icients des
     matrices.

Validation de lâ€™Ã©tape 1
   ïƒ¼   A ichage de la matrice ğ‘€ associÃ©e Ã  lâ€™exemple mÃ©tÃ©o (ï¬chier exemple_meteo.txt) ;
   ïƒ¼   Calcul de ğ‘€ , vous devez obtenir le mÃªme rÃ©sultat que celui prÃ©sentÃ© en exemple ;
   ïƒ¼   Calcul de ğ‘€ , vous devez obtenir le mÃªme rÃ©sultat que celui prÃ©sentÃ© en exemple ;
   ïƒ¼   Avec les ï¬chiers exemple : calculer ğ‘€ , pour laquelle la di Ã©rence entre ğ‘€ et ğ‘€   est
       infÃ©rieure Ã  ğœ€ = 0.01. (attention, sur certains exemples, ce critÃ¨re peut ne pas
       fonctionner : indiquez quels sont ces exemples).

Ã‰tape 2 : propriÃ©tÃ©s des graphes de Markov
Les graphes de Markov prÃ©sentent les propriÃ©tÃ©s suivantes (sans dÃ©monstration)

   ïƒ¼ Un graphe irrÃ©ductible (une seule classe) possÃ¨de une unique distribution limite

   ïƒ¼ Pour un graphe non irrÃ©ductible (plusieurs classes) :
        o Les classes transitoires ont une distribution limite nulle (les probabilitÃ©s sont
            toutes Ã©gales Ã  0) ;
        o Les classes persistantes ont chacune une distribution limite ;
Dans les ï¬chiers matrix.c / matrix.h, ajoutez la fonction suivante (en utilisant les Ã©lÃ©ments
de la partie 2) :
/**
 * @brief Extracts a submatrix corresponding to a specific
component of a graph partition.
 *
 * @param matrix The original adjacency matrix of the graph.
 * @param part The partition of the graph into strongly
connected components.
 * @param compo_index The index of the component to extract.
 * @return t_matrix The submatrix corresponding to the
specified component.
 */
t_matrix subMatrix(t_matrix matrix, t_partition part, int
compo_index);

Dans cette â€˜sous-matriceâ€™, on ne garde que les lignes et colonnes des sommets appartenant Ã 
une composante donnÃ©e.

Cela vous permettra de crÃ©er une â€˜sous-matriceâ€™ pour une classe donnÃ©e : en calculant les
puissances de ces sous-matrices, vous obtiendrez les distributions stationnaires par classes.

Validation de lâ€™Ã©tape 2
Vous obtenez les distributions stationnaires pour chacune des classes dâ€™un graphe (test sur
les ï¬chiers exemples fournis).

Ã‰tape 3 (dÃ©ï¬ en bonus)
PÃ©riodicitÃ© des classes : certaines classes nâ€™ont pas de distribution limite, mais plusieurs
distributions stationnaires (et pÃ©riodiques), car les probabilitÃ©s Ã©voluent de maniÃ¨re â€˜cycliqueâ€™.
Voici un exemple dâ€™un graphe pÃ©riodique :




Ce graphe est irrÃ©ductible (une seule classe â€“ vÃ©riï¬ez-le avec votre programme), mais possÃ¨de
une â€˜pÃ©riodeâ€™ . En partant de tout sommet, on peut y revenir au bout de 3 Ã©tapes (mais ni une
Ã©tape, ni 2), ou au bout de 6 Ã©tapes.
Voici donc le dÃ©ï¬ Ã  relever - je vous fournis le code brut de calcul de pÃ©riode pour une
classe (code Ã  adapter en fonction de vos structures de donnÃ©es et des fonctions que vous avez
Ã©crites).


int gcd(int *vals, int nbvals) {
    if (nbvals == 0) return 0;
    int result = vals[0];
    for (int i = 1; i < nbvals; i++) {
        int a = result;
        int b = vals[i];
        while (b != 0) {
            int temp = b;
            b = a % b;
            a = temp;
        }
        result = a;
    }
    return result;
}
int getPeriod(t_matrix sub_matrix)
{
    int n = sub_matrix.rows;
    int *periods = (int *)malloc(n * sizeof(int));
    int period_count = 0;
    int cpt = 1;
    t_matrix power_matrix = createEmptyMatrix(n);
    t_matrix result_matrix = createEmptyMatrix(n);
    copyMatrix(power_matrix, sub_matrix);

     for (cpt = 1; cpt <= n; cpt++)
     {
         int diag_nonzero = 0;
         for (int i = 0; i < n; i++)
         {
             if (power_matrix.data[i][i] > 0.0f)
             {
                 diag_nonzero = 1;
             }
         }
         if (diag_nonzero) {
             periods[period_count] = cpt;
             period_count++;
         }
         multiplyMatrices(power_matrix, sub_matrix, result_matrix);
         copyMatrix(power_matrix, result_matrix);
     }

     return gcd(periods, period_count);
}
DÃ©ï¬ numÃ©ro 1
Commentez et expliquez ce code, intÃ©grez-le Ã  votre programme.

DÃ©ï¬ numÃ©ro 2
calculez les pÃ©riodes des classes du graphe (la pÃ©riode sera alors la mÃªme pour tous les
sommets appartenant Ã  cette classe), puis trouver les distributions stationnaires associÃ©es.
